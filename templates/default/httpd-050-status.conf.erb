# Generated by Chef for <%= node['hostname'] %>.
# Local modifications will be overwritten.
<%- if @params[:listen].to_i == 0 %>
<%- @params[:listen] = 80 %>
<%- end %>
<%- if @params[:domain].nil? or @params[:domain].empty? %>
<%- @params[:domain] = "status.#{node['fqdn']}" %>
<%- end %>
<%- if @params[:listen].to_i != 80 and @params[:listen].to_i != 443 %>
Listen <%= @params[:listen] %>
<%- end %>

<VirtualHost *:<%= @params[:listen] %>>
    ServerName <%= @params[:domain] %>
    DocumentRoot <%= node['apache']['docroot_dir'] %>

    <Directory <%= node['apache']['docroot_dir'] %>>
        Allow from All
    </Directory>

    CustomLog /dev/null combined

    <IfModule mod_status.c>
    <%- if @params[:server_info] == true %>
    <Location /server-info>
        SetHandler server-info
        Order deny,allow
        Deny from all
        Allow from 127.0.0.1
    </Location>
    <%- end %>

    <%- if @params[:server_status] == true %>
    <Location /server-status>
        SetHandler server-status
        Order deny,allow
        Deny from all
        Allow from 127.0.0.1
    </Location>
    <%- end %>

    <%- if @params[:balancer_manager] == true %>
    <Location /balancer-manager>
        SetHandler balancer-manager
        Order deny,allow
        Deny from all
        Allow from 127.0.0.1
    </Location>
    <%- end %>
    </IfModule>
</VirtualHost>

<IfModule mod_status.c>
#
# ExtendedStatus controls whether Apache will generate "full" status
# information (ExtendedStatus On) or just basic information (ExtendedStatus
# Off) when the "server-status" handler is called. The default is Off.
#
<% if node['apache']['ext_status'] %>
ExtendedStatus On
<% else -%>
ExtendedStatus Off
<% end -%>
#
</IfModule>
